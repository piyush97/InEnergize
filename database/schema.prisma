// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Management
model User {
  id                String      @id @default(cuid())
  email             String      @unique
  firstName         String?
  lastName          String?
  profileImage      String?
  emailVerified     DateTime?
  hashedPassword    String?
  isActive          Boolean     @default(true)
  subscriptionTier  SubscriptionTier @default(FREE)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  // OAuth connections
  accounts          Account[]
  sessions          Session[]
  
  // LinkedIn integration
  linkedinProfiles  LinkedinProfile[]
  
  // Content and automation
  contentItems      ContentItem[]
  automationRules   AutomationRule[]
  
  // Analytics and usage
  usageMetrics      UsageMetrics[]
  
  // Notifications
  notifications     Notification[]
  
  // AI-Generated Content
  banners           Banner[]
  
  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("sessions")
}

// LinkedIn Profile Management
model LinkedinProfile {
  id                    String      @id @default(cuid())
  userId                String
  linkedinId            String      @unique
  linkedinUrl           String
  
  // Profile data
  firstName             String
  lastName              String
  headline              String?
  summary               String?
  industry              String?
  location              String?
  profileImageUrl       String?
  backgroundImageUrl    String?
  
  // Connection data
  connectionCount       Int         @default(0)
  followerCount         Int         @default(0)
  
  // Settings
  isActive              Boolean     @default(true)
  autoPostEnabled       Boolean     @default(false)
  autoEngageEnabled     Boolean     @default(false)
  
  // Timestamps
  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt
  lastSyncedAt          DateTime?
  
  // Relations
  user                  User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  contentItems          ContentItem[]
  automationRules       AutomationRule[]
  engagementActivities  EngagementActivity[]
  
  @@map("linkedin_profiles")
}

// Content Management
model ContentItem {
  id                String      @id @default(cuid())
  userId            String
  linkedinProfileId String?
  
  // Content data
  title             String
  content           String      @db.Text
  contentType       ContentType
  status            ContentStatus @default(DRAFT)
  
  // Media attachments
  mediaUrls         String[]    @default([])
  mediaType         MediaType?
  
  // Scheduling
  scheduledAt       DateTime?
  publishedAt       DateTime?
  
  // Performance
  views             Int         @default(0)
  likes             Int         @default(0)
  comments          Int         @default(0)
  shares            Int         @default(0)
  clickThroughRate  Float?
  engagementRate    Float?
  
  // AI enhancement
  aiGenerated       Boolean     @default(false)
  aiPrompt          String?
  
  // Timestamps
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  // Relations
  user              User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  linkedinProfile   LinkedinProfile? @relation(fields: [linkedinProfileId], references: [id])
  
  @@map("content_items")
}

// AI-Generated Banner Management
model Banner {
  id                String      @id @default(cuid())
  userId            String
  
  // Banner metadata
  name              String?
  description       String?
  industry          String
  style             BannerStyle @default(NATURAL)
  
  // Generation data
  prompt            String      @db.Text
  dalleModel        String      @default("dall-e-3")
  generationId      String      @unique
  
  // Image data
  imageUrl          String
  imageData         String?     @db.Text // base64 encoded
  format            String      @default("PNG")
  fileSize          Int
  dimensions        Json        // {width: 1584, height: 396}
  
  // Branding and customization
  branding          Json?       // Company name, role, colors, etc.
  textElements      String[]    @default([])
  colorScheme       String?
  
  // Quality and compliance
  qualityScore      Float       @default(0)
  isLinkedInCompliant Boolean   @default(true)
  altTexts          String[]    @default([])
  
  // Usage and analytics
  downloadCount     Int         @default(0)
  isPublic          Boolean     @default(false)
  tags              String[]    @default([])
  
  // AI usage metrics
  generationCost    Float       @default(0)
  tokensUsed        Int         @default(0)
  
  // Timestamps
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  lastUsedAt        DateTime?
  
  // Relations
  user              User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  variations        BannerVariation[]
  
  @@index([userId, createdAt])
  @@index([industry])
  @@index([isPublic])
  @@map("banners")
}

// Banner Variations for A/B Testing
model BannerVariation {
  id                String      @id @default(cuid())
  bannerId          String
  
  // Variation metadata
  name              String
  description       String?
  variationType     VariationType @default(STYLE)
  
  // Generation data
  prompt            String      @db.Text
  generationId      String      @unique
  
  // Image data
  imageUrl          String
  imageData         String?     @db.Text
  format            String      @default("PNG")
  fileSize          Int
  dimensions        Json
  
  // Performance metrics
  qualityScore      Float       @default(0)
  downloadCount     Int         @default(0)
  userRating        Float?
  
  // Timestamps
  createdAt         DateTime    @default(now())
  
  // Relations
  banner            Banner      @relation(fields: [bannerId], references: [id], onDelete: Cascade)
  
  @@index([bannerId])
  @@map("banner_variations")
}

// Banner Templates for Quick Generation
model BannerTemplate {
  id                String      @id @default(cuid())
  
  // Template metadata
  name              String
  description       String
  industry          String
  category          TemplateCategory @default(PROFESSIONAL)
  
  // Template configuration
  promptTemplate    String      @db.Text
  colorSchemes      String[]    @default([])
  designElements    String[]    @default([])
  keywords          String[]    @default([])
  
  // Template settings
  isActive          Boolean     @default(true)
  isPremium         Boolean     @default(false)
  
  // Usage metrics
  usageCount        Int         @default(0)
  averageRating     Float       @default(0)
  
  // Template preview
  previewImageUrl   String?
  
  // Timestamps
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  @@index([industry])
  @@index([category])
  @@index([isActive])
  @@map("banner_templates")
}

// Automation Rules
model AutomationRule {
  id                String          @id @default(cuid())
  userId            String
  linkedinProfileId String
  
  // Rule configuration
  name              String
  description       String?
  ruleType          AutomationType
  isActive          Boolean         @default(true)
  
  // Trigger conditions
  triggerConditions Json
  
  // Actions to perform
  actions           Json
  
  // Execution settings
  frequency         FrequencyType
  timeSlots         String[]        @default([])
  
  // Rate limiting
  maxExecutionsPerDay Int           @default(10)
  executionsToday   Int             @default(0)
  lastExecutedAt    DateTime?
  
  // Timestamps
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  
  // Relations
  user              User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  linkedinProfile   LinkedinProfile @relation(fields: [linkedinProfileId], references: [id], onDelete: Cascade)
  
  @@map("automation_rules")
}

// Engagement Tracking
model EngagementActivity {
  id                String          @id @default(cuid())
  linkedinProfileId String
  
  // Activity details
  activityType      EngagementType
  targetType        TargetType      // POST, PROFILE, COMMENT
  targetId          String          // LinkedIn ID of target
  targetUrl         String?
  
  // Activity data
  message           String?
  isSuccessful      Boolean         @default(true)
  errorMessage      String?
  
  // Timestamps
  createdAt         DateTime        @default(now())
  
  // Relations
  linkedinProfile   LinkedinProfile @relation(fields: [linkedinProfileId], references: [id], onDelete: Cascade)
  
  @@map("engagement_activities")
}

// Analytics and Metrics
model UsageMetrics {
  id                String      @id @default(cuid())
  userId            String
  
  // Metric data
  metricType        MetricType
  metricValue       Float
  metricUnit        String?
  
  // Context
  context           Json?
  
  // Timestamp (for time-series data)
  timestamp         DateTime    @default(now())
  
  // Relations
  user              User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("usage_metrics")
}

// Notification System
model Notification {
  id                String            @id @default(cuid())
  userId            String
  
  // Notification content
  title             String
  message           String            @db.Text
  type              NotificationType
  priority          NotificationPriority @default(MEDIUM)
  
  // Status
  isRead            Boolean           @default(false)
  isArchived        Boolean           @default(false)
  
  // Metadata
  metadata          Json?
  actionUrl         String?
  
  // Timestamps
  createdAt         DateTime          @default(now())
  readAt            DateTime?
  
  // Relations
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("notifications")
}

// Enums
enum SubscriptionTier {
  FREE
  BASIC
  PROFESSIONAL
  ENTERPRISE
}

enum ContentType {
  POST
  ARTICLE
  POLL
  VIDEO
  CAROUSEL
  DOCUMENT
}

enum ContentStatus {
  DRAFT
  SCHEDULED
  PUBLISHED
  ARCHIVED
  FAILED
}

enum MediaType {
  IMAGE
  VIDEO
  DOCUMENT
  CAROUSEL
}

enum AutomationType {
  AUTO_LIKE
  AUTO_COMMENT
  AUTO_CONNECT
  AUTO_POST
  AUTO_SHARE
  AUTO_MESSAGE
}

enum FrequencyType {
  ONCE
  DAILY
  WEEKLY
  MONTHLY
  CUSTOM
}

enum EngagementType {
  LIKE
  COMMENT
  SHARE
  CONNECT
  MESSAGE
  VIEW
  FOLLOW
}

enum TargetType {
  POST
  PROFILE
  COMMENT
  ARTICLE
  COMPANY
}

enum MetricType {
  PROFILE_VIEWS
  POST_IMPRESSIONS
  ENGAGEMENT_RATE
  CONNECTION_GROWTH
  CONTENT_PERFORMANCE
  API_USAGE
  AUTOMATION_EXECUTIONS
}

enum NotificationType {
  SYSTEM
  CONTENT_PUBLISHED
  AUTOMATION_COMPLETED
  ENGAGEMENT_RECEIVED
  CONNECTION_REQUEST
  MILESTONE_ACHIEVED
  ERROR_ALERT
  QUOTA_WARNING
}

enum NotificationPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum BannerStyle {
  NATURAL
  VIVID
}

enum VariationType {
  STYLE
  COLOR
  TEXT
  LAYOUT
  BRANDING
}

enum TemplateCategory {
  PROFESSIONAL
  CREATIVE
  MINIMALIST
  CORPORATE
  STARTUP
  PERSONAL_BRAND
}